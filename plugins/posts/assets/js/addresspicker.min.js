jQuery(document).ready(function(a){function h(f){a("#gmw-location-loader").fadeToggle("fast",function(){setTimeout(function(){"bad"==f?a("#gmw-bad-location-message").fadeToggle("fast",function(){a(this).addClass("gmw-location-message")}):a("#gmw-good-location-message").fadeToggle("fast",function(){a(this).addClass("gmw-location-message")})},500)})}function m(){a(".gmw-location-message").fadeToggle("fast",function(){a(this).removeClass("gmw-location-message");setTimeout(function(){a("#gmw-location-loader").fadeToggle("fast")},
500)})}function q(f){a(".gmw-location-message").fadeToggle("fast",function(){a(this).removeClass("gmw-location-message");"bad"==f?a("#gmw-bad-location-message").fadeToggle("fast",function(){a(this).addClass("gmw-location-message")}):a("#gmw-good-location-message").fadeToggle("fast",function(){a(this).addClass("gmw-location-message")})})}function t(a){r(a.coords.latitude,a.coords.longitude,"yes")}function u(a){switch(a.code){case a.PERMISSION_DENIED:alert("User denied the request for Geolocation");
h("bad");break;case a.POSITION_UNAVAILABLE:alert("Location information is unavailable.");h("bad");break;case a.TIMEOUT:alert("The request to get user location timed out.");h("bad");break;case a.UNKNOWN_ERROR:alert("An unknown error occurred."),h("bad")}}function r(f,b,c){geocoder=new google.maps.Geocoder;var e=new google.maps.LatLng(f,b);geocoder.geocode({latLng:e,region:"us"},function(e,k){if(k==google.maps.GeocoderStatus.OK){if(e[0]){"yes"==c&&alert("Address successfully returned.");var l=!1;addressf=
e[0].formatted_address;a("#_wppl_address").val(addressf);a("#gmw_check_address").val(addressf);a("#_wppl_formatted_address").val(addressf);a("#wppl-addresspicker").val(addressf);a("#_wppl_lat").val(f);a("#gmw_check_lat").val(f);a("#_wppl_long").val(b);a("#gmw_check_long").val(b);var d=e[0].address_components;for(x in d){"street_number"==d[x].types&&void 0!=d[x].long_name&&(l=d[x].long_name,a("#_wppl_street").val(l));if("route"==d[x].types&&void 0!=d[x].long_name){var g=d[x].long_name;0!=l&&void 0!=
l&&(g=l+" "+g);a("#_wppl_street").val(g)}"locality,political"==d[x].types&&void 0!=d[x].long_name&&(g=d[x].long_name,a("#_wppl_city").val(g));"administrative_area_level_1,political"==d[x].types&&(void 0!=d[x].short_name&&(g=d[x].short_name,a("._wppl_state").val(g)),void 0!=d[x].long_name&&(g=d[x].long_name,a("._wppl_state_long").val(g)));"postal_code"==d[x].types&&void 0!=d[x].long_name&&(g=d[x].long_name,a("#_wppl_zipcode").val(g));"country,political"==d[x].types&&(void 0!=d[x].short_name&&(g=d[x].short_name,
a("._wppl_country").val(g)),void 0!=d[x].long_name&&(g=d[x].long_name,a("._wppl_country_long").val(g)))}}h("good")}else alert("Geocoder failed due to: "+k),n(),h("bad")})}function v(){m();var f=a("#_wppl_street").val(),b=a("#_wppl_apt").val(),c=a("#_wppl_city").val(),e=a("#_wppl_state").val(),s=a("#_wppl_zipcode").val(),k=a("#_wppl_country").val();retAddress=f+" "+c+" "+e+" "+s+" "+k;addressApt=f+" "+b+" "+c+" "+e+" "+s+" "+k;geocoder=new google.maps.Geocoder;geocoder.geocode({address:retAddress},
function(c,f){if(f==google.maps.GeocoderStatus.OK){alert("Latitude / Longitude successfully returned");retLat=c[0].geometry.location.lat();retLong=c[0].geometry.location.lng();addressf=c[0].formatted_address;a("#_wppl_lat").val(retLat);a("#_wppl_long").val(retLong);a("#_wppl_address").val(addressApt);a("#_wppl_formatted_address").val(addressf);a("#wppl-addresspicker").val(addressf);var b=c[0].address_components;for(x in b){if("administrative_area_level_1,political"==b[x].types){if(void 0!=b[x].short_name){var e=
b[x].short_name;a("._wppl_state").val(e)}void 0!=b[x].long_name&&(e=b[x].long_name,document.getElementById("_wppl_state_long").value=e)}"country,political"==b[x].types&&(void 0!=b[x].short_name&&(e=b[x].short_name,a("._wppl_country").val(e)),void 0!=b[x].long_name&&(e=b[x].long_name,document.getElementById("_wppl_country_long").value=e))}h("good")}else alert("Geocode was not successful for the following reason: "+f),n(),h("bad")})}function n(){a(".gmw-location-manually-wrapper input:text, .gmw-location-section.autocomplete input:text").val("")}
var p=gmwSettings.admin_settings.edit_post_zoom_level;""!=a("#_wppl_lat").val()&&""!=a("#_wppl_long").val()?(initLat=a("#_wppl_lat").val(),initLng=a("#_wppl_long").val()):(initLat=gmwSettings.admin_settings.edit_post_latitude,initLng=gmwSettings.admin_settings.edit_post_longitude);a.widget("ui.addresspicker",{options:{appendAddressString:"",draggableMarker:!0,regionBias:null,mapOptions:{zoom:parseInt(p),center:new google.maps.LatLng(initLat,initLng),scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP},
elements:{map:!1,lat:!1,lng:!1,route:!1,locality:!1,postal_code:!1,country:!1,type:!1}},marker:function(){return this.gmarker},map:function(){return this.gmap},updatePosition:function(){this._updatePosition(this.gmarker.getPosition(),"no")},reloadPosition:function(){this.gmarker.setVisible(!0);this.gmarker.setPosition(new google.maps.LatLng(this.lat.val(),this.lng.val()));this.gmap.setCenter(this.gmarker.getPosition())},selected:function(){return this.selectedResult},_create:function(){this.geocoder=
new google.maps.Geocoder;this.element.autocomplete({source:a.proxy(this._geocode,this),focus:a.proxy(this._focusAddress,this),select:a.proxy(this._selectAddress,this)});this.lat=a(this.options.elements.lat);this.lng=a(this.options.elements.lng);this.street_number=a(this.options.elements.street_number);this.route=a(this.options.elements.route);this.locality=a(this.options.elements.locality);this.administrative_area_level_1=a(this.options.elements.administrative_area_level_1);this.postal_code=a(this.options.elements.postal_code);
this.country=a(this.options.elements.country);this.type=a(this.options.elements.type);this.options.elements.map&&(this.mapElement=a(this.options.elements.map),this._initMap())},_initMap:function(){this.lat&&this.lat.val()&&(this.options.mapOptions.center=new google.maps.LatLng(this.lat.val(),this.lng.val()));this.gmap=new google.maps.Map(this.mapElement[0],this.options.mapOptions);this.gmarker=new google.maps.Marker({position:this.options.mapOptions.center,map:this.gmap,draggable:this.options.draggableMarker});
google.maps.event.addListener(this.gmarker,"dragend",a.proxy(this._markerMoved,this));this.gmarker.setVisible(!1)},_updatePosition:function(a,b,c){"yes"==b&&r(a.lat(),a.lng(),"no");"yes"==c&&(this.lat&&this.lat.val(a.lat()),this.lng&&this.lng.val(a.lng()))},_markerMoved:function(){m();a("#gmw-location-wrapper input:text").val("");a("#gmw-saved-data input:text").val("");this._updatePosition(this.gmarker.getPosition(),"yes")},_geocode:function(a,b){this.geocoder.geocode({address:a.term+this.options.appendAddressString,
region:this.options.regionBias},function(a,f){if(f==google.maps.GeocoderStatus.OK)for(var h=0;h<a.length;h++)a[h].label=a[h].formatted_address;b(a)})},_findInfo:function(a,b){for(var c=0;c<a.address_components.length;c++){var e=a.address_components[c];if(-1!=e.types.indexOf(b))return e.short_name}return""},_findInfoLong:function(a,b){for(var c=0;c<a.address_components.length;c++){var e=a.address_components[c];if(-1!=e.types.indexOf(b))return e.long_name}return""},_focusAddress:function(f,b){var c=
b.item;a("#_wppl_address").val(c.formatted_address);a("#_wppl_formatted_address").val(c.formatted_address);c&&(this.gmarker&&(this.gmarker.setPosition(c.geometry.location),this.gmarker.setVisible(!0),this.gmap.fitBounds(c.geometry.viewport)),this._updatePosition(c.geometry.location,"no","yes"),this.street_number?(this.street_number.val(this._findInfo(c,"street_number")),this.route&&this.route.val(this._findInfo(c,"street_number")+" "+this._findInfo(c,"route"))):this.route&&this.route.val(this._findInfo(c,
"route")),this.locality&&this.locality.val(this._findInfo(c,"locality")),this.administrative_area_level_1&&(this.administrative_area_level_1.val(this._findInfo(c,"administrative_area_level_1")),a("._wppl_state_long").val(this._findInfoLong(c,"administrative_area_level_1"))),this.postal_code&&this.postal_code.val(this._findInfo(c,"postal_code")),this.country&&(this.country.val(this._findInfo(c,"country")),a("._wppl_country_long").val(this._findInfoLong(c,"country"))),this.type&&this.type.val(c.types[0]))},
_selectAddress:function(a,b){this.selectedResult=b.item;q("good")}});a.extend(a.ui.addresspicker,{version:"@VERSION"});Array.indexOf||(Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return b;return-1});jQuery("#addresspicker").addresspicker();p=jQuery("#wppl-addresspicker").addresspicker({elements:{map:"#map",lat:"#_wppl_lat",lng:"#_wppl_long",route:"#_wppl_street",locality:"#_wppl_city",administrative_area_level_1:"._wppl_state",postal_code:"#_wppl_zipcode",country:"._wppl_country"}});
p.addresspicker("marker").setVisible(!0);p.addresspicker("updatePosition");a("#publish").click(function(f){1==addressMandatory?""==a("#_wppl_lat").val()||""==a("#_wppl_long").val()||""==a("#_wppl_address").val()?(f.preventDefault(f),a(".spinner").hide(),alert("Post cannot be published. You must enter a vallid address. Please make sure that latitude and longitude fields are not empty."),setTimeout(function(){jQuery("#publish").removeClass("button-primary-disabled")},2E3)):(a("#_wppl_lat").removeAttr("disabled"),
a("#_wppl_long").removeAttr("disabled"),a("#_wppl_address").removeAttr("disabled")):(a("#_wppl_lat").removeAttr("disabled"),a("#_wppl_long").removeAttr("disabled"),a("#_wppl_address").removeAttr("disabled"))});""!=a("#_wppl_lat").val()&&""!=a("#_wppl_long").val()&&""!=a("#_wppl_formatted_address")&&q("good");a("#gmw-admin-locator-btn").click(function(){n();m();navigator.geolocation?navigator.geolocation.getCurrentPosition(t,u):alert("Geolocation is not supported by this browser.")});a("#gmw-admin-delete-btn").click(function(){n();
q("bad")});a("#gmw-admin-getlatlong-btn").click(function(){v()});a("#gmw-admin-getaddress-btn").click(function(){m();var a=document.getElementById("_wppl_lat").value,b=document.getElementById("_wppl_long").value;r(a,b,"yes")});jQuery(".metabox-tabs li a").each(function(a){var b=jQuery(this).parent().attr("class").replace(/active /,"");"active"!=jQuery(this).attr("class")&&jQuery("div."+b).hide();jQuery("div."+b).addClass("tab-content");jQuery(this).click(function(){jQuery(this).parent().parent().parent().children("div").hide();
jQuery(this).parent().parent("ul").find("li.active").removeClass("active");jQuery("div."+b).show();jQuery("li."+b).addClass("active")})});jQuery(".heading").hide();jQuery(".metabox-tabs").show()});